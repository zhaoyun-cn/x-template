# 🎮 DOTA2 游廊 RPG - 英雄/技能系统设计文档

> 版本：v1.0  
> 最后更新：2025-11-28  
> 状态：设计完成，待开发

---

## 📋 目录

1.[系统架构总览](#一系统架构总览)
2.[职业系统](#二职业系统)
3.[技能栏配置](#三技能栏配置)
4.[技能点系统](#四技能点系统)
5.[技能树系统](#五技能树系统)
6.[护石系统](#六护石系统)
7.[天赋树系统](#七天赋树系统)
8.[城镇NPC](#八城镇npc)
9.[UI界面规划](#九ui界面规划)
10.[数据结构设计](#十数据结构设计)
11.[开发任务清单](#十一开发任务清单)

---

## 一、系统架构总览

```
┌─────────────────────────────────────────────────────────────────┐
│                         英雄系统                                 │
├─────────────────────────────────────────────────────────────────┤
│  职业选择                                                        │
│  ├── ⚔️ 战士 (可选)                                              │
│  └── 🔒 ???  (尚未开发)                                          │
├─────────────────────────────────────────────────────────────────┤
│                         技能系统                                 │
├───────────────┬─────────────────┬───────────────────────────────┤
│   技能树       │    技能栏        │        护石系统               │
│  (城镇NPC)     │   (已装备)       │      (技能强化)               │
├───────────────┼─────────────────┼───────────────────────────────┤
│ • 消耗技能点   │ • Q/W/E 小技能   │ • 每技能 3+2 槽              │
│ • 学习新技能   │ • R 大招         │ • 3开放 / 2锁定(团本解锁)    │
│ • 城镇NPC切换  │ • 被动1 先天     │ • 护石绑定单个技能           │
│               │ • 被动2 可选     │ • 副本掉落/保底商店          │
├───────────────┴─────────────────┴───────────────────────────────┤
│                         天赋树                                   │
├─────────────────────────────────────────────────────────────────┤
│ • 每级获得 1 天赋点                                              │
│ • 强化英雄通用能力                                               │
│ • 可免费重置                                                     │
└─────────────────────────────────────────────────────────────────┘
```

---

## 二、职业系统

### 2.1 职业列表

| 职业 | 状态 | 资源系统 | 先天被动 | 定位 |
|------|------|----------|----------|------|
| ⚔️ **战士** | ✅ 可选 | 怒气（攻击积攒） | 重伤 - 暴击触发流血 | 近战物理输出 |
| 🔒 **???** | 🔒 锁定 | - | - | 尚未开发 |

### 2.2 战士详细设定

| 项目 | 设定 |
|------|------|
| **定位** | 近战物理输出 |
| **资源** | 怒气（攻击积攒，消耗释放技能） |
| **先天被动** | 重伤 - 暴击触发流血效果 |
| **特色** | 高爆发、AOE、生存能力 |

### 2.3 战士技能池

| 类型 | 技能名 | 状态 | 说明 |
|------|--------|------|------|
| 小技能 | 冲锋 | ✅ 已实现 | 位移技能 |
| 小技能 | 巨人打击 | ✅ 已实现 | 单体高伤 |
| 小技能 | 雷霆一击 | ✅ 已实现 | AOE 伤害 |
| 小技能 | 旋风斩 | 📋 规划中 | 持续AOE |
| 小技能 | 盾击 | 📋 规划中 | 控制技能 |
| 小技能 | 跳劈 | 📋 规划中 | 位移+伤害 |
| 大招 | 斩杀 | ✅ 已实现 | 斩杀低血量敌人 |
| 大招 | 狂暴 | 📋 规划中 | 自我强化 |
| 大招 | 战神降临 | 📋 规划中 | 究极大招 |
| 先天被动 | 重伤 | ✅ 已实现 | 暴击触发流血 |
| 可选被动 | 铁壁 | 📋 规划中 | 护甲+30% |
| 可选被动 | 嗜血 | 📋 规划中 | 吸血+10% |
| 可选被动 | 狂战士 | 📋 规划中 | 血量越低伤害越高 |
| 可选被动 | 坚韧 | 📋 规划中 | 受控时间-30% |

---

## 三、技能栏配置

### 3.1 技能槽位

| 槽位 | 类型 | 默认键位 | 说明 |
|------|------|----------|------|
| **小技能 1** | 主动 | Q | 从技能树学习装备 |
| **小技能 2** | 主动 | W | 从技能树学习装备 |
| **小技能 3** | 主动 | E | 从技能树学习装备 |
| **大招** | 主动 | R | 从大招池选择 |
| **先天被动** | 被动 | - | 职业自带，不可更换 |
| **可选被动** | 被动 | - | 从被动池选择一个 |

### 3.2 技能切换规则

| 项目 | 设定 |
|------|------|
| **切换地点** | 仅限城镇特定 NPC |
| **切换限制** | 只能切换已学会的技能 |
| **护石绑定** | 护石跟随技能，切换回来保留原护石配置 |

---

## 四、技能点系统

### 4.1 技能点获取规则

- **普通等级**：每级获得 **1** 技能点
- **特殊等级**：每 **5** 级获得 **3** 技能点（5、10、15、20...）

### 4.2 技能点累计表

| 等级 | 本级获得 | 累计技能点 |
|------|----------|-----------|
| 1 | 1 | 1 |
| 2 | 1 | 2 |
| 3 | 1 | 3 |
| 4 | 1 | 4 |
| **5** | **3** | **7** |
| 6 | 1 | 8 |
| 7 | 1 | 9 |
| 8 | 1 | 10 |
| 9 | 1 | 11 |
| **10** | **3** | **14** |
| 11 | 1 | 15 |
| 12 | 1 | 16 |
| 13 | 1 | 17 |
| 14 | 1 | 18 |
| **15** | **3** | **21** |
| 16 | 1 | 22 |
| 17 | 1 | 23 |
| 18 | 1 | 24 |
| 19 | 1 | 25 |
| **20** | **3** | **28** |

### 4.3 技能点计算公式

```typescript
function calculateSkillPoints(level: number): number {
    let points = level; // 每级1点
    points += Math.floor(level / 5) * 2; // 每5级额外+2点(总共+3)
    return points;
}
```

---

## 五、技能树系统

### 5.1 技能树界面结构

```
┌─────────────────────────────────────────┐
│            战士技能树                    │
│         技能点：7 / 已用：3              │
├─────────────────────────────────────────┤
│  【小技能】                              │
│  ├── 冲锋 (已学) ✓        消耗：1点     │
│  ├── 巨人打击 (已学) ✓    消耗：1点     │
│  ├── 雷霆一击 (已学) ✓    消耗：1点     │
│  ├── 旋风斩 (需要等级10)  消耗：2点     │
│  ├── 盾击 (需要等级15)    消耗：2点     │
│  └── 跳劈 (需要等级20)    消耗：3点     │
├─────────────────────────────────────────┤
│  【大招】                                │
│  ├── 斩杀 (已学) ✓        消耗：2点     │
│  ├── 狂暴 (需要等级15)    消耗：3点     │
│  └── 战神降临 (需要等级25) 消耗：5点    │
├─────────────────────────────────────────┤
│  【可选被动】                            │
│  ├── 铁壁 - 护甲+30%      消耗：2点     │
│  ├── 嗜血 - 吸血+10%      消耗：2点     │
│  ├── 狂战士 - 低血高伤    消耗：3点     │
│  └── 坚韧 - 控制-30%      消耗：2点     │
└─────────────────────────────────────────┘
```

### 5.2 技能学习流程

```
玩家在城镇 → 找到技能NPC → 打开技能树界面
                              │
                ┌─────────────┼─────────────┐
                ▼             ▼             ▼
           【学习技能】   【装备技能】   【切换技能】
           消耗技能点     拖入技能栏     替换已装备
           检查等级要求
```

---

## 六、护石系统

### 6.1 护石品质等级

| 等级 | 颜色 | 品质名称 | Roll 值范围 | 获取途径 |
|------|------|----------|------------|----------|
| **1级** | ⚪ 白色 | 普通 | 最低档 (1-20%) | 保底商店 / 普通掉落 |
| **2级** | 🟢 绿色 | 优秀 | 较低档 (15-40%) | 普通副本 |
| **3级** | 🔵 蓝色 | 稀有 | 中等档 (30-60%) | 精英副本 |
| **4级** | 🟣 紫色 | 史诗 | 较高档 (50-80%) | Boss 掉落 |
| **5级** | 🟠 橙色 | 传说 | 最高档 (70-100%) | 高难副本 / 稀有掉落 |

### 6.2 护石槽位

| 槽位 | 状态 | 解锁条件 |
|------|------|----------|
| 槽位 1 | ✅ 开放 | 默认开放 |
| 槽位 2 | ✅ 开放 | 默认开放 |
| 槽位 3 | ✅ 开放 | 默认开放 |
| 槽位 4 | 🔒 锁定 | 击杀团本 Boss |
| 槽位 5 | 🔒 锁定 | 击杀团本 Boss |

### 6.3 护石规则

| 项目 | 设定 |
|------|------|
| **镶嵌费用** | 免费 |
| **拆卸费用** | 免费 |
| **绑定规则** | 镶嵌后绑定该技能，无法给其他技能使用 |
| **复用规则** | 需要拥有多个相同护石才能给不同技能使用 |
| **跟随规则** | 切换技能时护石配置保留，切换回来仍有效 |

### 6.4 护石获取途径

| 途径 | 说明 |
|------|------|
| **副本掉落** | 随机 Roll 数值，品质由副本难度决定 |
| **保底商店** | 用材料购买，获得该类型护石的最低 Roll 值版本 |

### 6.5 护石类型示例

| 类型 | 效果 | 适用技能 |
|------|------|----------|
| **范围扩大** | AOE 范围 +X% | AOE 技能 |
| **暴击强化** | 暴击率 +X% | 所有攻击技能 |
| **伤害增幅** | 技能伤害 +X% | 所有伤害技能 |
| **吸血** | 造成伤害的 X% 转化为生命 | 所有伤害技能 |
| **冷却缩减** | 技能冷却 -X% | 所有主动技能 |
| **多重打击** | 额外攻击 1 次，伤害 -30% | 攻击技能 |
| **燃烧** | 附加 X% 伤害的持续灼烧 | 伤害技能 |
| **冰冻** | X% 几率冻结敌人 | 伤害技能 |
| **连锁** | 技能可跳跃至 X 个额外目标 | 投射物技能 |
| **穿透** | 投射物可穿透 X 个敌人 | 投射物技能 |

### 6.6 护石界面示意

```
┌─────────────────────────────────────────────────────────┐
│                    雷霆一击                              │
│                   【已装备】                             │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  护石槽位：                                              │
│                                                         │
│   [ ◆ ]    [ ◆ ]    [ ○ ]    [ 🔒 ]    [ 🔒 ]          │
│   范围     暴击      空槽     锁定      锁定             │
│   +30%    +12%                                          │
│   🔵蓝    🟣紫                                          │
│                                                         │
├─────────────────────────────────────────────────────────┤
│  已镶嵌效果：                                            │
│  • 范围扩大 (蓝色) - AOE范围 +30%                       │
│  • 暴击强化 (紫色) - 暴击率 +12%                        │
├─────────────────────────────────────────────────────────┤
│  [ 镶嵌护石 ]  [ 拆卸护石 ]                              │
└─────────────────────────────────────────────────────────┘
```

---

## 七、天赋树系统

### 7.1 天赋点规则

| 项目 | 设定 |
|------|------|
| **获取方式** | 每级获得 1 天赋点 |
| **重置费用** | 免费 |
| **天赋类型** | 通用强化（不针对特定技能） |

### 7.2 天赋分类

| 类型 | 示例 |
|------|------|
| **基础属性** | 力量+10, 敏捷+10, 智力+10, 生命+100, 护甲+5 |
| **百分比强化** | 物理伤害+5%, 元素伤害+5%, 护甲+10%, 生命+5% |
| **攻击相关** | 攻击速度+5%, 暴击率+3%, 暴击伤害+15% |
| **防御相关** | 生命回复+X, 护甲+X%, 抗性+5% |
| **机制改变** | 投射物+1, AOE范围+15%, 冷却缩减+5% |
| **特殊效果** | 击杀回血X%, 受伤反弹X%伤害, 格挡几率+X% |

### 7.3 天赋树结构示意

```
                        【起点】
                           │
            ┌──────────────┼──────────────┐
            ▼              ▼              ▼
        【力量路线】    【通用路线】    【技巧路线】
        生命/护甲       伤害/速度       暴击/特效
            │              │              │
            ▼              ▼              ▼
        [生命+100]     [伤害+3%]     [暴击率+2%]
            │              │              │
            ▼              ▼              ▼
        [生命+100]     [伤害+3%]     [暴击率+2%]
            │              │              │
            ▼              ▼              ▼
        [生命+5%]      [伤害+5%]     [暴击率+3%]
            │              │              │
            ▼              ▼              ▼
        [护甲+10%]    [攻速+5%]     [暴伤+15%]
            │              │              │
            ▼              ▼              ▼
        [格挡+5%]     [冷却-5%]     [暴伤+20%]
            │              │              │
            └──────────────┼──────────────┘
                           ▼
                    【核心天赋区】
                  [投射物+1] [AOE+20%]
                  [击杀回血] [伤害反弹]
```

---

## 八、城镇NPC

### 8.1 技能大师 NPC

| 项目 | 设定 |
|------|------|
| **名称** | 技能大师 / 战斗导师 (待定) |
| **位置** | 城镇主城区 |
| **模型** | 待定 |
| **功能** | 学习技能 / 切换技能 / 镶嵌护石 |
| **交互** | 点击NPC打开技能树界面 |

### 8.2 城镇布局规划

```
┌─────────────────────────────────────────┐
│            城镇 NPC 布局                 │
├─────────────────────────────────────────┤
│                                         │
│          [复活点/出生点]                 │
│                 │                       │
│                 ▼                       │
│          ┌───────────┐                  │
│          │   广场     │                  │
│          │           │                  │
│          │ [传送门]   │                  │
│          └───────────┘                  │
│            │       │                    │
│            ▼       ▼                    │
│      [技能NPC]  [商店NPC]               │
│      技能大师   护石商店                 │
│                                         │
└─────────────────────────────────────────┘
```

---

## 九、UI界面规划

### 9.1 需要开发的界面

| 界面 | 功能 | 入口 | 优先级 |
|------|------|------|--------|
| **职业选择界面** | 游戏开始时选择职业 | 游戏开始 | P1 |
| **技能树界面** | 学习/切换技能 | 城镇NPC | P2 |
| **护石镶嵌界面** | 镶嵌/拆卸护石 | 技能树界面内 | P3 |
| **天赋树界面** | 分配/重置天赋点 | 角色界面或NPC | P4 |
| **护石背包界面** | 查看/管理护石 | 角色界面 | P3 |

### 9.2 职业选择界面

```
┌─────────────────────────────────────────────────────────┐
│                    选择你的职业                          │
├─────────────────────────────────────────────────────────┤
│                                                         │
│   ┌─────────────┐           ┌─────────────┐            │
│   │             │           │             │            │
│   │   ⚔️ 战士   │           │   🔒 ???     │            │
│   │             │           │             │            │
│   │  近战物理   │           │   尚未开发   │            │
│   │  怒气系统   │           │   敬请期待   │            │
│   │             │           │             │            │
│   └─────────────┘           └─────────────┘            │
│      [ 选择 ]                  [ 锁定 ]                 │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

---

## 十、数据结构设计

### 10.1 玩家技能数据

```typescript
interface PlayerSkillData {
    // 职业
    class: "warrior" | "unknown";
    
    // 技能点
    skillPoints: number;
    usedSkillPoints: number;
    
    // 已学习的技能
    learnedSkills: string[];
    
    // 已装备的技能
    equippedSkills: {
        slot1: string | null;      // Q
        slot2: string | null;      // W
        slot3: string | null;      // E
        ultimate: string | null;   // R
        innatePassive: string;     // 先天被动（职业决定）
        chosenPassive: string | null;  // 可选被动
    };
    
    // 每个技能的护石配置
    skillRuneConfig: {
        [skillName: string]: SkillRuneSlots;
    };
}

interface SkillRuneSlots {
    slot1: RuneItem | null;  // 开放
    slot2: RuneItem | null;  // 开放
    slot3: RuneItem | null;  // 开放
    slot4: RuneItem | null;  // 锁定
    slot5: RuneItem | null;  // 锁定
    unlockedSlots: number;   // 已解锁槽位数（默认3）
}
```

### 10.2 护石数据

```typescript
interface RuneItem {
    id: string;              // 唯一ID
    type: string;            // 护石类型 (范围扩大/暴击强化等)
    quality: 1 | 2 | 3 | 4 | 5;  // 品质等级 (1白/2绿/3蓝/4紫/5橙)
    rollValue: number;       // Roll 值 (实际效果数值)
    rollPercent: number;     // Roll 百分比 (0-100，表示在该品质范围内的位置)
    boundToSkill: string | null;  // 绑定的技能（null=未绑定）
}

// 护石类型定义
interface RuneType {
    id: string;
    name: string;
    description: string;
    effectType: "percent" | "flat" | "mechanic";
    minValue: number;
    maxValue: number;
}
```

### 10.3 天赋数据

```typescript
interface PlayerTalentData {
    talentPoints: number;           // 可用天赋点
    usedTalentPoints: number;       // 已使用天赋点
    allocatedTalents: string[];     // 已分配的天赋节点ID
}

interface TalentNode {
    id: string;
    name: string;
    description: string;
    effect: TalentEffect;
    position: { x: number; y: number };
    prerequisites: string[];  // 前置天赋节点
    cost: number;            // 消耗天赋点（通常为1）
}

interface TalentEffect {
    type: string;    // "strength" | "damage_percent" | "crit_chance" 等
    value: number;
}
```

### 10.4 技能定义

```typescript
interface SkillDefinition {
    id: string;
    name: string;
    description: string;
    icon: string;
    type: "active_small" | "active_ultimate" | "passive_innate" | "passive_choice";
    class: "warrior" | "all";
    unlockLevel: number;      // 解锁等级
    skillPointCost: number;   // 技能点消耗
    cooldown: number;
    rageCost: number;         // 怒气消耗（战士）
    effects: SkillEffect[];
}
```

---

## 十一、开发任务清单

### Phase 1：职业选择（优先级：高）

- [ ] 职业选择界面 UI
- [ ] 战士可选，第二职业显示锁定
- [ ] 职业选择逻辑
- [ ] 职业数据存储

### Phase 2：城镇 NPC（优先级：高）

- [ ] 创建技能大师 NPC 实体
- [ ] NPC 模型和位置配置
- [ ] NPC 交互逻辑（点击打开界面）
- [ ] 检测玩家是否在城镇区域

### Phase 3：技能树界面（优先级：高）

- [ ] 技能树 UI 界面设计
- [ ] 技能列表展示（小技能/大招/被动）
- [ ] 技能学习逻辑（检查等级、消耗技能点）
- [ ] 技能装备/切换逻辑
- [ ] 技能点显示与计算
- [ ] 已装备技能高亮显示

### Phase 4：护石系统（优先级：中）

- [ ] 护石数据结构实现
- [ ] 护石背包 UI
- [ ] 护石镶嵌界面（集成到技能树）
- [ ] 护石镶嵌逻辑
- [ ] 护石拆卸逻辑
- [ ] 护石效果应用到技能
- [ ] 护石品质颜色显示

### Phase 5：天赋树（优先级：中）

- [ ] 天赋树 UI 界面
- [ ] 天赋节点显示
- [ ] 天赋分配逻辑
- [ ] 天赋重置逻辑（免费）
- [ ] 天赋效果应用到角色属性

### Phase 6：护石获取（优先级：低）

- [ ] 副本掉落护石逻辑
- [ ] Roll 值随机系统
- [ ] 护石品质由副本难度决定
- [ ] 保底商店 UI
- [ ] 保底商店购买逻辑

### Phase 7：后续扩展（优先级：低）

- [ ] 第二职业开发
- [ ] 更多战士技能
- [ ] 团本 Boss（解锁护石槽）
- [ ] 更多护石类型

---

## 附录：参考游戏

| 游戏 | 参考内容 |
|------|----------|
| **DNF（地下城与勇士）** | 技能树结构、技能学习方式 |
| **POE2（流放之路2）** | 护石系统、天赋树、技能自由搭配 |
| **暗黑破坏神3** | 技能槽位、符文强化 |
| **DOTA2 原版** | 技能键位、冷却系统 |

---

> 📝 **文档维护说明**  
> 本文档记录了英雄/技能系统的完整设计方案。  
> 如有修改请更新版本号和日期。